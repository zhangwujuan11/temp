"use strict";(self["webpackChunkfront_vue"]=self["webpackChunkfront_vue"]||[]).push([[627],{627:function(e,t,i){i.r(t),i.d(t,{default:function(){return D}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"rectify"},[t("div",{staticClass:"maincon"},[t("div",{staticClass:"serbox"},[21002!=e.identityCode?t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.$store.state.rectification=!0}}},[e._v("发起整改")]):e._e(),t("el-select",{staticClass:"selinpout",attrs:{placeholder:"状态",size:"small"},on:{change:function(t){return e.changestatus()}},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-select",{attrs:{size:"small",placeholder:"我的待办"},on:{change:function(t){return e.changestatus()}},model:{value:e.valuet,callback:function(t){e.valuet=t},expression:"valuet"}},e._l(e.optionst,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-input",{staticClass:"serinput",nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.changestatus()}},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),t("el-button",{staticClass:"submi",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.changestatus()}}},[e._v("搜索")])],1),t("ul",{staticClass:"con"},e._l(e.lidatas,(function(s,r){return t("li",{key:r,on:{click:function(t){return e.liclick(s)}}},[t("p",{staticClass:"title"},[e._v(e._s(s.title))]),t("p",[t("span",[e._v(e._s(e._f("conversion")(s.createTime)))]),t("span",{staticClass:"submi",attrs:{type:"primary",size:"small"}},[e._v(e._s(s.statusDesc))])]),s.cover?e._e():t("img",{attrs:{src:i(4577),alt:""}}),s.cover?t("img",{attrs:{src:s.cover,alt:""}}):e._e()])})),0),t("el-pagination",{attrs:{background:"","current-page":e.currentPage,layout:"prev, pager, next, jumper","page-size":e.PageSize,total:e.total},on:{"current-change":e.whatepage,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1),t("Rectification"),t("Havedatadilog",{attrs:{havedatainfo:e.havedatainfo}}),t("Notstarted",{attrs:{havedatainfo:e.havedatainfo}})],1)},r=[],o=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"发起检查修改",visible:e.$store.state.rectification,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.$store.state,"rectification",t)},closed:e.closede}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"整改标题",prop:"title"}},[t("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._l(e.ruleForm.rectifyProblemUpdates,(function(i,s){return t("div",{key:s,staticClass:"addbox"},[t("p",{staticClass:"addboxtitle"},[e._v(" 整改内容"+e._s(s+1)+" "),0!=s?t("i",{staticClass:"el-icon-delete",on:{click:function(t){return t.preventDefault(),e.removeDomain(i)}}}):e._e()]),t("el-form-item",{attrs:{label:"内容",prop:"rectifyProblemUpdates."+s+".context",rules:{required:!0,message:"内容不能为空",trigger:"blur"}}},[t("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:i.context,callback:function(t){e.$set(i,"context",t)},expression:"item.context"}})],1),t("el-form-item",{attrs:{label:"图片"}},[t("el-upload",{attrs:{action:e.baseurl+"v1/communal/files/scopes/rectify/attachment/actions/upload","list-type":"picture-card","on-success":e.handleImageAdd.bind(this,s),accept:".gif,.jpg,.jpeg,.png,.GIF,.JPG,.PNG","on-preview":e.handlePictureCardPreview,"before-upload":e.beforeImageUpload,"on-remove":e.handleRemove.bind(this,s),"file-list":i.fileListImg}},[t("i",{staticClass:"el-icon-upload",attrs:{slot:"default"},slot:"default"}),t("el-dialog",{attrs:{"append-to-body":"",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)],1),t("el-form-item",{attrs:{label:"附件"}},[t("el-upload",{attrs:{action:e.baseurl+"v1/communal/files/scopes/rectify/attachment/actions/upload","on-success":e.handlePdfAdd.bind(this,s),"on-preview":e.previewPdf,"before-upload":e.beforePdfUpload,"on-remove":e.handlePdfRemove.bind(this,s),accept:".pdf"}},[t("el-button",{attrs:{size:"small"}},[t("i",{staticClass:"el-icon-upload2 el-icon--right"}),e._v("上传PDF文件 (小于50M) ")])],1)],1),t("el-form-item",{attrs:{label:"类型",prop:"rectifyProblemUpdates."+s+".dataType",rules:{required:!0,message:"请选择类型",trigger:"blur"}}},[t("el-radio-group",{model:{value:i.dataType,callback:function(t){e.$set(i,"dataType",t)},expression:"item.dataType"}},[t("el-radio",{attrs:{label:1}},[e._v("质量")]),t("el-radio",{attrs:{label:2}},[e._v("安全")])],1)],1),t("el-form-item",{attrs:{label:"隐患点",prop:"rectifyProblemUpdates."+s+".hidDanger",rules:{required:!0,message:"请选择隐患点",trigger:"blur"}}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:i.hidDanger,callback:function(t){e.$set(i,"hidDanger",t)},expression:"item.hidDanger"}},e._l(e.dangerlist,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)})),t("span",{staticClass:"addDomain",on:{click:e.addDomain}},[e._v("+继续添加整改问题")]),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"发起时间",prop:"launchTime"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","picker-options":e.pickerOptions0,"value-format":"timestamp"},model:{value:e.ruleForm.launchTime,callback:function(t){e.$set(e.ruleForm,"launchTime",t)},expression:"ruleForm.launchTime"}})],1),t("el-form-item",{attrs:{label:"标段",prop:"sectionId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectone},model:{value:e.ruleForm.sectionId,callback:function(t){e.$set(e.ruleForm,"sectionId",t)},expression:"ruleForm.sectionId"}},e._l(e.processorDeptList,(function(e,i){return t("el-option",{key:i,attrs:{label:e.sectionName,value:e.sectionId}})})),1)],1),e.zerenbox?t("el-form-item",{attrs:{label:"责任人"}},[t("el-input",{staticStyle:{width:"220px"},attrs:{disabled:""},model:{value:e.processorList.nickName,callback:function(t){e.$set(e.processorList,"nickName",t)},expression:"processorList.nickName"}})],1):e._e(),t("el-form-item",{attrs:{label:"抄送",prop:"resource"}},[t("el-checkbox-group",{on:{change:e.clickCopied},model:{value:e.ruleForm.copiedType,callback:function(t){e.$set(e.ruleForm,"copiedType",t)},expression:"ruleForm.copiedType"}},e._l(e.copiedTypeList,(function(i){return t("el-checkbox",{key:i.id,attrs:{label:i.id,value:i.id}},[e._v(e._s(i.name))])})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"完成时间",prop:"finishTime"}},[t("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptions1,placeholder:"选择日期"},model:{value:e.ruleForm.finishTime,callback:function(t){e.$set(e.ruleForm,"finishTime",t)},expression:"ruleForm.finishTime"}})],1),""!=e.ruleForm.sectionId?t("el-form-item",{attrs:{label:"部门",prop:"processorDeptId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selecttwo},model:{value:e.ruleForm.processorDeptId,callback:function(t){e.$set(e.ruleForm,"processorDeptId",t)},expression:"ruleForm.processorDeptId"}},e._l(e.jobinfo,(function(e){return t("el-option",{key:parseInt(e.deptId),attrs:{label:e.deptName,value:e.deptId}})})),1)],1):e._e(),t("el-form-item",[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.ruleForm.sendSms,callback:function(t){e.$set(e.ruleForm,"sendSms",t)},expression:"ruleForm.sendSms"}},[e._v("是否发送手机短信提醒")])],1)],1)],1)],2),t("span",{staticClass:"dialog-footer",staticStyle:{"text-align":"center",display:"block"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.closedes()}}},[e._v("取 消")]),t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.savefrom("ruleForm")}}},[e._v("保 存")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("发起整改")])],1)],1)},a=[],l=(i(7658),i(7578)),n={inject:["reload"],data(){return{pickerOptions0:{disabledDate:e=>{if(""!=this.ruleForm.finishTime)return e.getTime()>new Date(this.ruleForm.finishTime).getTime()}},pickerOptions1:{disabledDate:e=>{if(""!=this.ruleForm.launchTime)return e.getTime()<new Date(this.ruleForm.launchTime).getTime()}},dangerlist:[{id:22001,name:"履约"},{id:22002,name:"进度"},{id:22003,name:"预制场"},{id:22004,name:"钢筋场"},{id:22005,name:"拌合站"},{id:22006,name:"驻地"},{id:22007,name:"地基"},{id:22008,name:"路面"},{id:22009,name:"桥梁"},{id:22010,name:"隧道"}],copiedTypeList:[{id:21001,name:"业主",disabled:!1},{id:21004,name:"交通局",disabled:!1},{id:21003,name:"监理",disabled:!1},{id:0,name:"无",disabled:!1}],ruleForm:{sectionId:"",title:"",copiedType:[21001,21003],finishTime:"",launchTime:(new Date).getTime(),processorDeptId:"",processorId:"",rectifyProblemUpdates:[{editType:0,title:"整改内容1",context:"",dataType:"",hidDanger:"",images:[],fileListImg:[],fileListPdf:[],attachments:[]}],sendSms:0},checkNum:1,processorList:{nickName:""},rules:{title:[{required:!0,message:"请输入",trigger:"blur"}],processorDeptId:[{required:!0,message:"请选择",trigger:"change"}],finishTime:[{required:!0,message:"请选择",trigger:"change"}],processorId:[{required:!0,message:"请选择",trigger:"change"}],sectionId:[{required:!0,message:"请选择",trigger:"change"}]},checkedCities:"",baseurl:"http://47.98.212.33:8080/",dialogVisible:!1,dialogImageUrl:"",processorDeptList:[],jobinfo:[],jobinfois:{},bumenbox:!1,zerenbox:!1}},mounted(){(0,l.qR)().then((e=>{this.processorDeptList=e.data.items}))},methods:{submitForm(e){this.$refs[e].validate((e=>{if(!e)return console.log("error submit!!"),!1;(0,l.sw)(this.ruleForm).then((e=>{200==e.code?(this.$message.success("发起整改成功"),this.$store.state.rectification=!1,this.reload()):this.$message.error(e.message)}))}))},savefrom(e){this.$refs[e].validate((e=>{if(!e)return console.log("error submit!!"),!1;(0,l.In)(this.ruleForm).then((e=>{200==e.code?(this.$message.success("保存成功"),this.$store.state.rectification=!1,this.reload()):this.$message.error(e.message)}))}))},removeDomain(e){var t=this.ruleForm.rectifyProblemUpdates.indexOf(e);-1!==t&&this.ruleForm.rectifyProblemUpdates.splice(t,1)},addDomain(){this.checkNum+=1,this.ruleForm.rectifyProblemUpdates.push({editType:0,title:"整改内容"+this.checkNum,context:"",dataType:"",hidDanger:"",images:[],attachments:[],fileListImg:[],fileListPdf:[]})},handleImageAdd(e,t){this.ruleForm.rectifyProblemUpdates[e].images.push(t.data.objectUrl)},handleRemove(e,t,i){this.ruleForm.rectifyProblemUpdates[e].images=i.map((e=>e.response.data.objectUrl))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeImageUpload(e){const t=e.size/1024/1024<5;t||this.$message.error("上传图片大小不能超过 5MB!")},handlePdfAdd(e,t,i){this.ruleForm.rectifyProblemUpdates[e].attachments.push(t.data.objectUrl)},previewPdf(e){e.url?window.open(e.url):window.open(e.response.data.objectUrl)},beforePdfUpload(e){const t=e.size/1024/1024<50;t||this.$message.error("上传pdf大小不能超过 50MB!")},handlePdfRemove(e,t,i){this.ruleForm.rectifyProblemUpdates[e].attachments=i.map((e=>e.response.data.objectUrl))},problem(e,t,i){return console.log(this.ruleForm.rectifyProblemUpdates.every((e=>!e.context))),this.ruleForm.rectifyProblemUpdates.every((e=>e.context))?this.ruleForm.rectifyProblemUpdates.every((e=>e.dataType))?this.ruleForm.rectifyProblemUpdates.every((e=>e.hidDanger))?void i():i(new Error("请选择隐患点")):i(new Error("请选择类型")):i(new Error("请输入整改内容"))},selectone(){this.ruleForm.processorDeptId="",this.zerenbox=!1;for(var e=0;e<this.processorDeptList.length;e++)this.processorDeptList[e].sectionId==this.ruleForm.sectionId&&(this.jobinfo=this.processorDeptList[e].deptList,this.ruleForm.sectionId=this.processorDeptList[e].sectionId,this.bumenbox=!0)},selecttwo(){for(var e=0;e<this.jobinfo.length;e++)this.ruleForm.processorDeptId==this.jobinfo[e].deptId&&(this.jobinfois=this.jobinfo[e]),this.$nextTick((()=>{(0,l.lE)(this.jobinfois.deptId).then((e=>{this.processorList=e.data.items[0],this.ruleForm.processorId=e.data.items[0].userId,this.zerenbox=!0}))}))},clickCopied(){0!=this.ruleForm.copiedType.length?this.ruleForm.copiedType.some((e=>0==e))&&(this.ruleForm.copiedType=[0],this.copiedTypeList.forEach((e=>{0!=e.id&&(e.disabled=!0)}))):this.copiedTypeList.forEach((e=>{0!=e.id&&(e.disabled=!1)}))},closede(){this.$store.state.rectification=!1},closedes(){this.$store.state.rectification=!1}}},c=n,d=i(3736),u=(0,d.Z)(c,o,a,!1,null,"6ee9d08c",null),m=u.exports,p=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"发起检查修改",visible:e.$store.state.havedatadilog,width:"80%","before-close":e.close},on:{"update:visible":function(t){return e.$set(e.$store.state,"havedatadilog",t)}}},[t("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"整改标题",prop:"title"}},[t("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._l(e.ruleForm.rectifyProblemUpdates,(function(i,s){return t("div",{key:s,staticClass:"addbox"},[t("p",{staticClass:"addboxtitle"},[e._v(" 整改内容"+e._s(s+1)+" ")]),t("el-form-item",{attrs:{label:"内容",prop:"rectifyProblemUpdates."+s+".context",rules:{required:!0,message:"内容不能为空",trigger:"blur"}}},[t("el-input",{staticStyle:{width:"90%"},attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:i.context,callback:function(t){e.$set(i,"context",t)},expression:"item.context"}})],1),t("el-form-item",{attrs:{label:"图片"}},[t("el-upload",{attrs:{action:e.baseurl+"v1/communal/files/scopes/rectify/attachment/actions/upload","list-type":"picture-card","on-success":e.handleImageAdd.bind(this,s),accept:".gif,.jpg,.jpeg,.png,.GIF,.JPG,.PNG","on-preview":e.handlePictureCardPreview,"before-upload":e.beforeImageUpload,"on-remove":e.handleRemove.bind(this,s),"file-list":i.fileListImg}},[t("i",{staticClass:"el-icon-upload",attrs:{slot:"default"},slot:"default"}),t("el-dialog",{attrs:{"append-to-body":"",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)],1),t("el-form-item",{attrs:{label:"附件"}},[t("el-upload",{attrs:{action:e.baseurl+"v1/communal/files/scopes/rectify/attachment/actions/upload","on-success":e.handlePdfAdd.bind(this,s),"on-preview":e.previewPdf,"file-list":i.fileListPdf,"before-upload":e.beforePdfUpload,"on-remove":e.handlePdfRemove.bind(this,s),accept:".pdf"}},[t("el-button",{attrs:{size:"small"}},[t("i",{staticClass:"el-icon-upload2 el-icon--right"}),e._v("上传PDF文件 (小于50M) ")])],1)],1),t("el-form-item",{attrs:{label:"类型",prop:"rectifyProblemUpdates."+s+".dataType",rules:{required:!0,message:"请选择类型",trigger:"blur"}}},[t("el-radio-group",{model:{value:i.dataType,callback:function(t){e.$set(i,"dataType",t)},expression:"item.dataType"}},[t("el-radio",{attrs:{label:1}},[e._v("质量")]),t("el-radio",{attrs:{label:2}},[e._v("安全")])],1)],1),t("el-form-item",{attrs:{label:"隐患点",prop:"rectifyProblemUpdates."+s+".hidDanger",rules:{required:!0,message:"请选择隐患点",trigger:"blur"}}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:i.hidDanger,callback:function(t){e.$set(i,"hidDanger",t)},expression:"item.hidDanger"}},e._l(e.dangerlist,(function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)})),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"发起时间",prop:"launchTime"}},[t("el-date-picker",{attrs:{type:"date",placeholder:"选择日期",format:"yyyy-MM-dd","picker-options":e.pickerOptions0,"value-format":"timestamp"},model:{value:e.ruleForm.launchTime,callback:function(t){e.$set(e.ruleForm,"launchTime",t)},expression:"ruleForm.launchTime"}})],1),t("el-form-item",{attrs:{label:"标段",prop:"sectionId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectone},model:{value:e.ruleForm.sectionId,callback:function(t){e.$set(e.ruleForm,"sectionId",t)},expression:"ruleForm.sectionId"}},e._l(e.processorDeptList,(function(e,i){return t("el-option",{key:i,attrs:{label:e.sectionName,value:e.sectionId}})})),1)],1),e.zerenbox?t("el-form-item",{attrs:{label:"责任人"}},[t("el-input",{staticStyle:{width:"220px"},attrs:{disabled:""},model:{value:e.processorList.nickName,callback:function(t){e.$set(e.processorList,"nickName",t)},expression:"processorList.nickName"}})],1):e._e(),t("el-form-item",{attrs:{label:"抄送",prop:"resource"}},[t("el-checkbox-group",{on:{change:e.clickCopied},model:{value:e.ruleForm.copiedType,callback:function(t){e.$set(e.ruleForm,"copiedType",t)},expression:"ruleForm.copiedType"}},e._l(e.copiedTypeList,(function(i){return t("el-checkbox",{key:i.id,attrs:{label:i.id,value:i.id}},[e._v(e._s(i.name))])})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"完成时间",prop:"finishTime"}},[t("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"timestamp","picker-options":e.pickerOptions1,placeholder:"选择日期"},model:{value:e.ruleForm.finishTime,callback:function(t){e.$set(e.ruleForm,"finishTime",t)},expression:"ruleForm.finishTime"}})],1),e.bumenbox?t("el-form-item",{attrs:{label:"部门",prop:"processorDeptId"}},[t("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selecttwo},model:{value:e.ruleForm.processorDeptId,callback:function(t){e.$set(e.ruleForm,"processorDeptId",t)},expression:"ruleForm.processorDeptId"}},e._l(e.jobinfo,(function(e){return t("el-option",{key:parseInt(e.deptId),attrs:{label:e.deptName,value:e.deptId}})})),1)],1):e._e(),t("el-form-item",[t("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.ruleForm.sendSms,callback:function(t){e.$set(e.ruleForm,"sendSms",t)},expression:"ruleForm.sendSms"}},[e._v("是否发送手机短信提醒")])],1)],1)],1)],2),t("span",{staticClass:"dialog-footer",staticStyle:{"text-align":"center",display:"block"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.close}},[e._v("取 消")]),t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.savefrom("ruleForm")}}},[e._v("保存修改")]),10004==e.ruleForm.status?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("发起整改")]):e._e()],1)],1)},h=[],f={inject:["reload"],props:["havedatainfo"],filters:{copies(e){return 21001==e?"业主":21002==e?"施工":21003==e?"监理":21004==e?"交通局":""},status(e){return 10003==e?"已关闭":1e4==e?"未开始":10001==e?"进行中":void 0}},data(){return{pickerOptions0:{disabledDate:e=>{if(""!=this.ruleForm.finishTime)return e.getTime()>=new Date(this.ruleForm.finishTime).getTime()}},pickerOptions1:{disabledDate:e=>{if(""!=this.ruleForm.launchTime)return e.getTime()<new Date(this.ruleForm.launchTime).getTime()}},dangerlist:[{id:22001,name:"履约"},{id:22002,name:"进度"},{id:22003,name:"预制场"},{id:22004,name:"钢筋场"},{id:22005,name:"拌合站"},{id:22006,name:"驻地"},{id:22007,name:"地基"},{id:22008,name:"路面"},{id:22009,name:"桥梁"},{id:22010,name:"隧道"}],copiedTypeList:[{id:21001,name:"业主",disabled:!1},{id:21004,name:"交通局",disabled:!1},{id:21003,name:"监理",disabled:!1},{id:0,name:"无",disabled:!1}],ruleForm:{sectionId:"",title:"",copiedType:[21001,21003],finishTime:"",launchTime:(new Date).getTime(),processorDeptId:"",processorId:"",rectifyProblemUpdates:[{editType:0,title:"整改内容1",context:"",dataType:"",hidDanger:"",images:[],fileListImg:[],fileListPdf:[],attachments:[]}],sendSms:0},processorList:{nickName:""},rules:{title:[{required:!0,message:"请输入",trigger:"blur"}],processorDeptId:[{required:!0,message:"请选择",trigger:"change"}],finishTime:[{required:!0,message:"请选择",trigger:"change"}],processorId:[{required:!0,message:"请选择",trigger:"change"}],sectionId:[{required:!0,message:"请选择",trigger:"change"}]},checkedCities:"",baseurl:"http://47.98.212.33:8080/",dialogVisible:!1,dialogImageUrl:"",processorDeptList:[],jobinfo:[],jobinfois:{},bumenbox:!1,zerenbox:!1,indexid:"",checkNum:1}},mounted(){(0,l.qR)().then((e=>{this.processorDeptList=e.data.items}))},methods:{submitForm(e){this.$refs[e].validate((e=>{if(!e)return console.log("error submit!!"),!1;for(let t=0;t<this.ruleForm.rectifyProblemUpdates.length;t++)this.updatazicon(this.ruleForm.rectifyProblemUpdates[t].problemId);this.$nextTick((()=>{(0,l.dZ)(this.ruleForm).then((e=>{200==e.code?(this.$message.success("发起整改成功"),this.reload(),this.$store.state.havedatadilog=!1):this.$message.error(e.message)}))}))}))},savefrom(e){this.$refs[e].validate((e=>{if(!e)return console.log("error submit!!"),!1;for(let t=0;t<this.ruleForm.rectifyProblemUpdates.length;t++)this.updatazicon(this.ruleForm.rectifyProblemUpdates[t].problemId);this.$nextTick((()=>{this.ruleForm.problems=this.ruleForm.rectifyProblemUpdates,(0,l.OY)(this.ruleForm).then((e=>{200==e.code?(this.$message.success("保存成功"),this.reload(),this.$store.state.havedatadilog=!1):this.$message.error(e.message)}))}))}))},updatazicon(e){let t=this.ruleForm.rectifyProblemUpdates.filter(((t,i,s)=>t.problemId==e));(0,l.lG)({rectifyId:this.ruleForm.rectifyId,problemId:e,data:t[0]}).then((e=>{200!=e.code&&this.$message.warning(e.message)}))},removeDomain(e){var t=this.ruleForm.rectifyProblemUpdates.indexOf(e);-1!==t&&this.ruleForm.rectifyProblemUpdates.splice(t,1)},handleImageAdd(e,t){this.ruleForm.rectifyProblemUpdates[e].images.push(t.data.objectUrl)},handleRemove(e,t,i){this.ruleForm.rectifyProblemUpdates[e].images=i.map((e=>e.url)),this.ruleForm.rectifyProblemUpdates[e].fileListImg=i.map((e=>e))},handlePdfRemove(e,t,i){this.ruleForm.rectifyProblemUpdates[e].attachments=i.map((e=>e.url)),this.ruleForm.rectifyProblemUpdates[e].fileListPdf=i.map((e=>e))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},beforeImageUpload(e){const t=e.size/1024/1024<5;t||this.$message.error("上传图片大小不能超过 5MB!")},handlePdfAdd(e,t,i){this.ruleForm.rectifyProblemUpdates[e].attachments.push(t.data.objectUrl)},previewPdf(e){e.url?window.open(e.url):window.open(e.response.data.objectUrl)},beforePdfUpload(e){const t=e.size/1024/1024<50;t||this.$message.error("上传pdf大小不能超过 50MB!")},problem(e,t,i){return console.log(this.ruleForm.rectifyProblemUpdates.every((e=>!e.context))),this.ruleForm.rectifyProblemUpdates.every((e=>e.context))?this.ruleForm.rectifyProblemUpdates.every((e=>e.dataType))?this.ruleForm.rectifyProblemUpdates.every((e=>e.hidDanger))?void i():i(new Error("请选择隐患点")):i(new Error("请选择类型")):i(new Error("请输入整改内容"))},selectone(){this.ruleForm.processorDeptId="",this.zerenbox=!1;for(var e=0;e<this.processorDeptList.length;e++)this.processorDeptList[e].sectionId==this.ruleForm.sectionId&&(this.jobinfo=this.processorDeptList[e].deptList,this.ruleForm.sectionId=this.processorDeptList[e].sectionId,this.bumenbox=!0)},selecttwo(){for(var e=0;e<this.jobinfo.length;e++)this.ruleForm.processorDeptId==this.jobinfo[e].deptId&&(this.jobinfois=this.jobinfo[e]),this.$nextTick((()=>{(0,l.lE)(this.jobinfois.deptId).then((e=>{this.processorList=e.data.items[0],this.ruleForm.processorId=e.data.items[0].userId,this.zerenbox=!0}))}))},clickCopied(){0!=this.ruleForm.copiedType.length?this.ruleForm.copiedType.some((e=>0==e))&&(this.ruleForm.copiedType=[0],this.copiedTypeList.forEach((e=>{0!=e.id&&(e.disabled=!0)}))):this.copiedTypeList.forEach((e=>{0!=e.id&&(e.disabled=!1)}))},close(){this.$store.state.havedatadilog=!1,(0,l.Bd)(this.indexid).then((e=>{this.ruleForm=e.data,this.ruleForm.rectifyProblemUpdates=e.data.problems,this.ruleForm.rectifyProblemUpdates.forEach((e=>{e.attachments?e.fileListPdf=e.attachments.map(((e,t)=>({name:`附件${t+1}`,url:e}))):(e.fileListPdf=[],e.attachments=[]),e.images?e.fileListImg=e.images.map((e=>({name:e,url:e}))):(e.fileListImg=[],e.images=[])})),e.data.copies?e.data.copiedType=e.data.copies:e.data.copiedType=[0],this.zerenbox=!0,this.processorList.nickName=this.ruleForm.processorNick;for(var t=0;t<this.processorDeptList.length;t++)this.processorDeptList[t].sectionId==this.ruleForm.sectionId&&(this.jobinfo=this.processorDeptList[t].deptList,this.ruleForm.processorDeptId=e.data.processorDeptId,this.bumenbox=!0)}))}},watch:{havedatainfo(e){this.indexid=e.rectifyId,(0,l.Bd)(e.rectifyId).then((e=>{this.ruleForm=e.data,this.ruleForm.rectifyProblemUpdates=e.data.problems,this.ruleForm.rectifyProblemUpdates.forEach((e=>{e.attachments?e.fileListPdf=e.attachments.map(((e,t)=>({name:`附件${t+1}`,url:e}))):(e.fileListPdf=[],e.attachments=[]),e.images?e.fileListImg=e.images.map((e=>({name:e,url:e}))):(e.fileListImg=[],e.images=[])})),e.data.copies?e.data.copiedType=e.data.copies:e.data.copiedType=[0],this.zerenbox=!0,this.processorList.nickName=this.ruleForm.processorNick;for(var t=0;t<this.processorDeptList.length;t++)this.processorDeptList[t].sectionId==this.ruleForm.sectionId&&(this.jobinfo=this.processorDeptList[t].deptList,this.ruleForm.processorDeptId=e.data.processorDeptId,this.bumenbox=!0)}))}}},b=f,g=(0,d.Z)(b,p,h,!1,null,"4a17bcf8",null),v=g.exports,y=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{visible:e.$store.state.notStarted,width:"80%","before-close":e.close},on:{"update:visible":function(t){return e.$set(e.$store.state,"notStarted",t)}}},[t("p",{staticStyle:{"margin-bottom":"30px"}},[e._v("【"+e._s(e._f("status")(e.ruleForm.status))+"】"+e._s(e.ruleForm.title))]),t("div",{staticClass:"frommaincom"},[t("p",[e._v("处理角色："+e._s(e.ruleForm.processorDeptName))]),t("p",[e._v("负责人："+e._s(e.ruleForm.processorNick))]),t("p",[e._v("手机号："+e._s(e.ruleForm.processorPhone))]),t("p",[e._v("抄送： "),e._l(e.ruleForm.copies,(function(i,s){return t("span",{key:s},[e._v(" "+e._s(e._f("copies")(i))+" ")])}))],2)]),t("div",{staticClass:"notStartedcon"},e._l(e.ruleForm.problems,(function(i,s){return t("div",{key:i.problemId,staticClass:"addbox"},[t("p",{staticClass:"addboxtitle"},[e._v(e._s(i.title))]),t("p",[e._v(" 【"+e._s(e._f("dataType")(i.dataType))+"】隐患点："+e._s(i.hidDangerName)+" ")]),t("p",[e._v(" 内容："+e._s(i.context)+" ")]),e._l(i.images,(function(i,s){return t("img",{key:s,staticClass:"itemimage",attrs:{src:i,fit:"fill"},on:{click:function(t){return e.showbigimg(i)}}})})),t("table",{staticClass:"table"},[t("thead",{staticStyle:{"background-color":"#F5F5F5"}},[t("tr",[t("th",[e._v("附件")]),t("th",[e._v("上传人")]),t("th",[e._v("操作")])])]),t("tbody",{staticClass:"modalTableBody"},e._l(i.attachments,(function(i,s){return t("tr",{key:s},[t("td",[e._v("附件"+e._s(s+1)+".pdf")]),t("td",[e._v("暂无")]),t("td",[t("span",{staticClass:"vwBtn",on:{click:function(t){return e.openUrl(i)}}},[e._v("查看")])])])})),0),null==i.attachments?t("p",{staticStyle:{"text-align":"center",width:"100%",color:"#ccc"}},[e._v("无附件")]):e._e()]),e._l(i.workflows,(function(r,o){return t("div",{key:r.workflowId,staticClass:"constructionbox"},["21002"==r.processorType&&"12001"!=r.actionCode?t("div",{staticClass:"addbox",staticStyle:{width:"calc(100% - 40px)","margin-bottom":"10px"}},[t("p",{staticClass:"addboxtitle"},[e._v("施工方处理意见")]),t("p",{staticStyle:{height:"40px"}},[e._v(" 【"+e._s(1==i.dataType?"质量":"安全")+"】隐患点:"+e._s(i.hidDangerName)+" "+e._s(r.actionDesc)+" ")]),t("p",[e._v(e._s(i.workflows[o].advice))]),t("div",e._l(i.workflows[o].images,(function(i,s){return t("p",{key:s,staticClass:"block",staticStyle:{display:"inline-block"}},[t("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:i,fit:"fill"},on:{click:function(t){return e.showbigimg(i)}}})])})),0),t("table",{staticClass:"table"},[t("thead",{staticStyle:{"background-color":"#F5F5F5"}},[t("tr",[t("th",[e._v("附件")]),t("th",[e._v("上传人")]),t("th",[e._v("操作")])])]),t("tbody",{staticClass:"modalTableBody"},e._l(i.workflows[o].attachments,(function(i,s){return t("tr",{key:s},[t("td",[e._v("附件"+e._s(s+1)+".pdf")]),t("td",[e._v("暂无")]),t("td",[t("span",{staticClass:"vwBtn",on:{click:function(t){return e.openUrl(i)}}},[e._v("查看")])])])})),0),null==i.workflows[o].attachments?t("p",{staticStyle:{"text-align":"center",width:"100%",color:"#ccc"}},[e._v("无附件")]):e._e()])]):e._e(),"21003"==r.processorType&&"12001"!=r.actionCode?t("div",{staticClass:"addbox",staticStyle:{width:"calc(100% - 40px)","margin-bottom":"10px"}},[t("p",{staticClass:"addboxtitle"},[e._v("监理方意见")]),i.workflows[o].attachments?t("p",[e._v(" 【"+e._s(1==i.dataType?"质量":"安全")+"】隐患点:"+e._s(i.hidDangerName)+" ")]):e._e(),t("div",{staticClass:"main"},[t("p",{domProps:{innerHTML:e._s(r.advice)}}),e._l(i.workflows[o].images,(function(i,s){return t("p",{key:s,staticClass:"block",staticStyle:{display:"inline-block"}},[t("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:i,fit:"fill"},on:{click:function(t){return e.showbigimg(i)}}})])})),i.workflows[o].attachments?t("table",{staticClass:"table"},[t("thead",{staticStyle:{"background-color":"#F5F5F5"}},[t("tr",[t("th",[e._v("附件")]),t("th",[e._v("上传人")]),t("th",[e._v("操作")])])]),t("tbody",{staticClass:"modalTableBody"},e._l(i.workflows[o].attachments,(function(i,s){return t("tr",{key:s},[t("td",[e._v("附件"+e._s(s+1)+".pdf")]),t("td",[e._v("暂无")]),t("td",[t("span",{staticClass:"vwBtn",on:{click:function(t){return e.openUrl(e.pdf)}}},[e._v("查看")])])])})),0),null==i.workflows[o].attachments?t("p",{staticStyle:{"text-align":"center",width:"100%",color:"#ccc"}},[e._v("无附件")]):e._e()]):e._e()],2)]):e._e(),e.identycode!=r.processorType||1e4!=e.ruleForm.status&&10001!=e.ruleForm.status||"12001"!=r.actionCode||e.fromuserid!=e.currentUserId?e._e():t("div",{staticClass:"constructionbox"},[t("div",{staticClass:"addbox",staticStyle:{width:"calc(100% - 40px)","margin-bottom":"10px"}},[21002==e.identycode?t("p",{staticClass:"addboxtitle"},[e._v("施工方处理意见")]):e._e(),21003==e.identycode?t("p",{staticClass:"addboxtitle"},[e._v("监理方处理意见")]):e._e(),t("div",[t("el-form",{staticClass:"demo-ruleForm",attrs:{"label-width":"100px"}},[t("el-form-item",{attrs:{label:"内容",prop:"advice"}},[t("el-input",{staticStyle:{width:"70%"},attrs:{placeholder:"请输入整改原因"},on:{input:e.change},model:{value:e.handleForm[s].advice,callback:function(t){e.$set(e.handleForm[s],"advice",t)},expression:"handleForm[index].advice"}})],1),t("el-form-item",{attrs:{label:"图片"}},[t("el-upload",{attrs:{action:e.baseurl+"v1/communal/files/scopes/rectify/attachment/actions/upload","list-type":"picture-card","on-success":e.handleImageAdd.bind(this,s),accept:".gif,.jpg,.jpeg,.png,.GIF,.JPG,.PNG","on-preview":e.handlePictureCardPreview,"before-upload":e.beforeImageUpload,"on-remove":e.handleRemove.bind(this,s),"file-list":i.fileListImg}},[t("i",{staticClass:"el-icon-upload",attrs:{slot:"default"},slot:"default"})])],1),t("el-form-item",{attrs:{label:"附件"}},[t("el-upload",{attrs:{action:e.baseurl+"v1/communal/files/scopes/rectify/attachment/actions/upload","on-success":e.handlePdfAdd.bind(this,s),"on-preview":e.previewPdf,"file-list":i.fileListPdf,"before-upload":e.beforePdfUpload,"on-remove":e.handlePdfRemove.bind(this,s),accept:".pdf"}},[t("el-button",{attrs:{size:"small"}},[t("i",{staticClass:"el-icon-upload2 el-icon--right"}),e._v("上传PDF文件 (小于50M) ")])],1)],1)],1)],1),t("div",{staticStyle:{width:"100%","text-align":"center"}},[t("el-button",{staticClass:"constructionsub",attrs:{type:"primary"},on:{click:function(t){return e.handelup(i.problemId,s)}}},[e._v(" 确认提交 ")])],1)])]),"21001"==r.processorType&&"12001"!=r.actionCode?t("div",{staticClass:"addbox",staticStyle:{width:"calc(100% - 40px)","margin-bottom":"10px"}},[t("p",{staticClass:"addboxtitle"},[e._v("业主方意见")]),t("div",{staticClass:"main"},[t("p",{domProps:{innerHTML:e._s(r.advice)}}),e._l(i.workflows[o].images,(function(i,s){return t("p",{key:s,staticClass:"block",staticStyle:{display:"inline-block"}},[t("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:i,fit:"fill"},on:{click:function(t){return e.showbigimg(i)}}})])}))],2)]):e._e(),"21001"!=r.processorType&&"21003"!=r.processorType||"12001"!=r.actionCode||r.processorId!=e.currentUserId||e.fromuserid==e.currentUserId?e._e():t("div",{staticStyle:{height:"80px","text-align":"center",padding:"0"}},[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.clcikAgree(i)}}},[e._v("同意")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.clcikReject(i)}}},[e._v("驳回")])],1)])})),t("el-dialog",{staticClass:"paddingmoer",attrs:{visible:e.rejectVisible,width:"70%","append-to-body":"",title:"驳回意见"},on:{"update:visible":function(t){e.rejectVisible=t}}},[t("div",{staticStyle:{border:"1px solid #ccc",width:"100%",height:"500px"}},[e.agreeVisible?e._e():t("div",{staticStyle:{border:"1px solid #ccc"}},[t("div",{staticStyle:{"border-bottom":"1px solid #ccc"},attrs:{id:"editor-toolbar"}}),t("div",{staticStyle:{height:"300px"},attrs:{id:"editor-text-area"}})])]),t("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"success"},on:{click:function(t){e.rejectVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.reject()}}},[e._v("确认驳回")])],1)]),t("el-dialog",{attrs:{visible:e.agreeVisible,width:"70%","append-to-body":"",title:"同意意见"},on:{"update:visible":function(t){e.agreeVisible=t}}},[e.rejectVisible?e._e():t("div",{staticStyle:{border:"1px solid #ccc"}},[t("div",{staticStyle:{"border-bottom":"1px solid #ccc"},attrs:{id:"editor-toolbar"}}),t("div",{staticStyle:{height:"300px"},attrs:{id:"editor-text-area"}})]),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"success"},on:{click:function(t){e.agreeVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.agree()}}},[e._v("确认同意")])],1)])],2)})),0),t("span",{staticClass:"dialog-footer",staticStyle:{"text-align":"center",display:"block"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.expo}},[e._v("导出")]),1e4!=e.ruleForm.status&&10001!=e.ruleForm.status||e.initiatorId!=e.currentUserId?e._e():t("el-button",{attrs:{type:"warning"},on:{click:e.changedilog}},[e._v("继续编辑")]),1e4!=e.ruleForm.status&&10001!=e.ruleForm.status||e.initiatorId!=e.currentUserId?e._e():t("el-button",{attrs:{type:"danger"},on:{click:e.deldata}},[e._v("删除整改")]),1e4!=e.ruleForm.status&&10001!=e.ruleForm.status||e.initiatorId!=e.currentUserId?e._e():t("el-button",{attrs:{type:"info"},on:{click:e.reback}},[e._v("撤回整改")]),t("el-button",{on:{click:e.close}},[e._v("关闭")])],1),t("el-dialog",{attrs:{"append-to-body":"",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1)},F=[],k=i(4720);const{createEditor:I,createToolbar:_}=window.wangEditor;var x={props:["havedatainfo"],inject:["reload"],filters:{copies(e){return 21001==e?"业主":21002==e?"施工":21003==e?"监理":21004==e?"交通局":""},status(e){return 10003==e?"已关闭":1e4==e?"未开始":10001==e?"进行中":void 0},dataType(e){return 1==e?"质量":2==e?"安全":void 0}},components:{},data(){return{mewdata:"",initiatorId:null,ruleForm:{},identycode:null,currentUserId:null,baseurl:"http://47.98.212.33:8080/",dialogVisible:!1,dialogImageUrl:"",handleForm:[],agreeVisible:!1,rejectVisible:!1,saveEditBtn:!1,items:[{message:"Foo",show:!1,id:1},{message:"Bar",show:!1,id:2}],fromuserid:null,editor:null,html:"",toolbarConfig:{},editorConfig:{placeholder:"请输入内容..."},mode:"simple",notStarted:!1,agreeOpinion:{accept:!0,advice:""},rejectOpinion:{accept:!1,advice:""},rectifyId:null,problemId:null}},mounted(){this.identycode=localStorage.getItem("identityCode"),this.currentUserId=localStorage.getItem("currentUserId"),setTimeout((()=>{this.html="不同意"}),1500)},beforeDestroy(){const e=this.editor;null!=e&&e.destroy()},methods:{reject(){0!=this.rejectOpinion.advice.length?(0,l.j3)({data:this.rejectOpinion,rectifyId:this.ruleForm.rectifyId,problemId:this.currentProblemId}).then((e=>{200==e.code?(this.$message.success("驳回成功"),this.rejectVisible=!1,(0,l.Bd)(this.ruleForm.rectifyId).then((e=>{this.ruleForm=e.data,this.fromuserid=e.data.processorId,this.initiatorId=e.data.initiatorId;let t=[],i=this.ruleForm.problems.length;for(let s=0;s<i;s++)t.push({advice:"",attachments:[],images:[]});this.handleForm=t}))):this.$message.error(e.message)})):this.$message.info("请输入驳回原因")},agree(){0!=this.agreeOpinion.advice.length?(0,l.j3)({data:this.agreeOpinion,rectifyId:this.ruleForm.rectifyId,problemId:this.currentProblemId}).then((e=>{200==e.code?(this.$message.success("成功"),this.agreeVisible=!1,(0,l.Bd)(this.ruleForm.rectifyId).then((e=>{this.ruleForm=e.data,this.fromuserid=e.data.processorId,this.initiatorId=e.data.initiatorId;let t=[],i=this.ruleForm.problems.length;for(let s=0;s<i;s++)t.push({advice:"",attachments:[],images:[]});this.handleForm=t}))):this.$message.error(e.message)})):this.$message.info("请输入意见")},clcikAgree(e){this.agreeVisible=!0,this.currentProblemId=e.problemId,this.agreeOpinion.advice="<p>同意</p>",this.$nextTick((()=>{this.setEditor()}))},clcikReject(e){this.rejectVisible=!0,this.currentProblemId=e.problemId,this.rejectOpinion.advice="<p>不同意<p>",this.$nextTick((()=>{this.setEditor()}))},showbigimg(e){this.dialogImageUrl=e,this.dialogVisible=!0},setEditor(){const e=this;let t=this.rejectVisible?this.rejectOpinion.advice:this.agreeOpinion.advice;window.editor=window.wangEditor.createEditor({selector:"#editor-text-area",html:t,config:{placeholder:"Type here...",MENU_CONF:{uploadImage:{fieldName:"your-fileName",base64LimitSize:10485760}},onChange(t){e.agreeOpinion.advice=t.getHtml(),e.rejectOpinion.advice=t.getHtml()}}}),window.toolbar=window.wangEditor.createToolbar({editor:editor,selector:"#editor-toolbar",config:{excludeKeys:["group-video","group-image","codeBlock"]}})},handelup(e,t){if(console.log(this.handleForm[t].advice),""==this.handleForm[t].advice)return this.$message.error("提交失败，处理内容不能为空"),!1;(0,l.E)({id:e,from:this.handleForm[t]}).then((e=>{200==e.code?(this.$message.success("问题处理成功"),(0,l.Bd)(this.ruleForm.rectifyId).then((e=>{this.ruleForm=e.data,this.fromuserid=e.data.processorId,this.initiatorId=e.data.initiatorId;let t=[],i=this.ruleForm.problems.length;for(let s=0;s<i;s++)t.push({advice:"",attachments:[],images:[]});this.handleForm=t}))):this.$message.error(e.message)})).catch((()=>{this.$message.error("提交失败，处理内容不能为空")}))},change(){this.$forceUpdate()},changedilog(){this.$store.state.notStarted=!1,this.$store.state.havedatadilog=!0},openUrl(e){window.open(e,"_blank")},deldata(){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,l.vQ)(this.ruleForm.rectifyId).then((e=>{200==e.code&&(this.$message({type:"success",message:"删除成功!"}),this.$store.state.notStarted=!1,this.reload())}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},expo(){let e=k.Loading.service({fullscreen:!0});(0,l.ir)(this.ruleForm.rectifyId).then((e=>{var t=document.createElement("iframe");t.src=e.data.notificationExcel.objectUrl,t.style.display="none",document.body.appendChild(t);var i=document.createElement("iframe");i.src=e.data.confirmationExcel.objectUrl,i.style.display="none",document.body.appendChild(i)})),e.close()},reback(){this.$confirm("此操作将撤回该整改, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,l.Iv)(this.ruleForm.rectifyId).then((e=>{200==e.code?(this.$message({type:"success",message:"撤回成功!"}),this.$store.state.notStarted=!1,this.reload()):this.$message.error(e.message)}))})).catch((()=>{this.$message({type:"info",message:"已取消撤回整改"})}))},handleImageAdd(e,t){this.handleForm[e].images.push(t.data.objectUrl)},handleRemove(e,t,i){this.handleForm[e].images=i.map((e=>e.response.data.objectUrl))},handlePdfRemove(e,t,i){this.handleForm[e].attachments=i.map((e=>e.url))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handlePdfAdd(e,t,i){this.handleForm[e].attachments.push(t.data.objectUrl)},previewPdf(e){e.url?window.open(e.url):window.open(e.response.data.objectUrl)},beforePdfUpload(e){const t=e.size/1024/1024<50;t||this.$message.error("上传pdf大小不能超过 50MB!")},beforeImageUpload(e){const t=e.size/1024/1024<5;t||this.$message.error("上传图片大小不能超过 5MB!")},close(){this.$store.state.notStarted=!1}},watch:{havedatainfo(e){(0,l.Bd)(e.rectifyId).then((e=>{this.ruleForm=e.data,this.fromuserid=e.data.processorId,this.initiatorId=e.data.initiatorId;let t=[],i=this.ruleForm.problems.length;for(let s=0;s<i;s++)t.push({advice:"",attachments:[],images:[]});this.handleForm=t}))}}},w=x,P=(0,d.Z)(w,y,F,!1,null,"6c37ac47",null),T=P.exports,U={components:{Rectification:m,Havedatadilog:v,Notstarted:T},filters:{conversion(e){return new Date(e).toLocaleString()}},data(){return{identityCode:21002,value:"",options:[{value:0,label:"全部"},{value:1,label:"未开始"},{value:2,label:"进行中"},{value:3,label:"已完成"}],valuet:"1",optionst:[{value:"0",label:"全部"},{value:"1",label:"我的待办"},{value:"2",label:"我的发起"}],input:"",total:0,currentPage:1,lidatas:[],havedatainfo:null,PageSize:8}},mounted(){this.identityCode=localStorage.getItem("identityCode"),this.changestatus()},methods:{getdatas(e){(0,l.DO)(e).then((e=>{this.total=e.data.total,this.lidatas=e.data.items}))},getusersurpost(e){(0,l.tO)(e).then((e=>{this.total=e.data.total,this.lidatas=e.data.items}))},getall(e){(0,l.Pu)(e).then((e=>{this.total=e.data.total,this.lidatas=e.data.items}))},changestatus(){"1"==this.valuet?this.getdatas({page:this.currentPage,status:this.value,keyword:this.input}):"2"==this.valuet?this.getusersurpost({page:this.currentPage,status:this.value,keyword:this.input}):"0"==this.valuet&&this.getall({page:this.currentPage,status:this.value,keyword:this.input})},whatepage(e){"1"==this.valuet?this.getdatas({page:e,status:this.value,keyword:this.input}):"2"==this.valuet?this.getusersurpost({page:e,status:this.value,keyword:this.input}):"0"==this.valuet&&this.getall({page:e,status:this.value,keyword:this.input})},liclick(e){this.havedatainfo=e,10004==e.status?this.$store.state.havedatadilog=!0:10004!=e.status&&(this.$store.state.notStarted=!0)}}},C=U,$=(0,d.Z)(C,s,r,!1,null,"2a322b96",null),D=$.exports},7578:function(e,t,i){i.d(t,{Bd:function(){return m},DO:function(){return r},E:function(){return v},In:function(){return d},Iv:function(){return b},OY:function(){return p},Pu:function(){return a},dZ:function(){return u},ir:function(){return f},j3:function(){return y},lE:function(){return n},lG:function(){return g},qR:function(){return l},sw:function(){return c},tO:function(){return o},vQ:function(){return h}});var s=i(4471);function r(e){return(0,s.Z)({url:"rectifies/v2/pending/actions/search",method:"get",params:{limit:8,offset:8*(e.page-1),status:e.status,keyword:e.keyword}})}function o(e){return(0,s.Z)({url:"rectifies/v2/initiate/actions/search",method:"get",params:{limit:8,offset:8*(e.page-1),status:e.status,keyword:e.keyword}})}function a(e){return(0,s.Z)({url:"/rectifies/v2/userRelated/actions/search",method:"get",params:{limit:8,offset:8*(e.page-1),status:e.status,keyword:e.keyword}})}function l(e){return(0,s.Z)({url:"v1/section/section/search",method:"get"})}function n(e){return(0,s.Z)({url:"accounts/v1/departments/"+e+"/users",method:"get"})}function c(e){return(0,s.Z)({url:"rectifies/v2",method:"post",data:e})}function d(e){return(0,s.Z)({url:"rectifies/v2/actions/saveAsDraft",method:"post",data:e})}function u(e){return(0,s.Z)({url:"/rectifies/v2/"+e.rectifyId+"/draft/actions/convertFormal",method:"put",data:e})}function m(e){return(0,s.Z)({url:"rectifies/v2/"+e,method:"get"})}function p(e){return(0,s.Z)({url:"/rectifies/v2/"+e.rectifyId,method:"put",data:e})}function h(e){return(0,s.Z)({url:"/rectifies/v2/"+e,method:"DELETE"})}function f(e){return(0,s.Z)({url:"/rectifies/v2/"+e+"/actions/exportExcel",method:"get"})}function b(e){return(0,s.Z)({url:"/rectifies/v2/"+e+"/actions/revoke",method:"post"})}function g(e){return(0,s.Z)({url:"/rectifies/v2/"+e.rectifyId+"/problems/"+e.problemId,method:"put",data:e.data})}function v(e){return(0,s.Z)({url:"/rectifies/v2/problems/"+e.id+"/actions/handle",method:"post",data:e.from})}function y(e){return(0,s.Z)({url:"/rectifies/v2/"+e.rectifyId+"/problems/"+e.problemId+"/actions/approve",method:"post",data:e.data})}},4577:function(e,t,i){e.exports=i.p+"static/img/uav_default.0d07631c.jpg"}}]);
//# sourceMappingURL=627.e39e6c75.js.map